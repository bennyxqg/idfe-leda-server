<!DOCTYPE html>
<html lang="zh-CN">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="author" content="Tencent-CP">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="Description" content="姜饼人逃亡之路">
<meta name="Keywords" content="姜饼人逃亡之路">
<meta name="author" content="idreamsky">
<title>姜饼人逃亡之路</title>
<link rel="stylesheet" href="<?php echo $full_base_url ?>/wap/css/style.css" media="all">
</head>
<body id="wp" class="stage">
<p style="display:none"><img src="<?php echo $full_base_url ?>/wap/images/logo.jpg" alt="姜饼人酷跑" /></p>
<div class="loading center"><p class="loading-txt">加载中…<span class="loading-num"></span>%</p></div>
<div class="wrapper">
	<section class="page page1 ploaded" id="page1">
        <h1 class="htx">姜饼人酷跑之姜饼人逃亡之路</h1>
        <div class="p1_bg1 ani bounceInLeft a1 delay03"><p class="p1_txt1 fHide ani bounceIn a1 delay1">呼chi~!</p><p class="p1_txt2 ani bounceIn a1 delay1_5">很久很久以前，森林里住了一个邪恶的女巫</p></div>
        <div class="p1_bg2 ani bounceInRight a1 delay2"><p class="p1_txt3 ani bounceIn a1 delay3">她俘获了很多人类的灵魂，制作成美味的饼干</p></div>
        <div class="p1_bg3 ani bounceInLeft a1 delay3_5"><div class="p1_witch ani a1 delay4_5"></div><p class="p1_txt4 fHide ani bounceIn a1 delay5_5">啊哈哈哈!!!!!这个饼干的味道真棒!</p></div>
	</section>

	<section class="page page2" id="page2">
		<div class="p2_bg1 ani bounceInLeft a1 delay03"><p class="p2_txt1 fHide ani bounceIn a1 delay1">????!!!!</p><p class="p2_txt2 fHide ani bounceIn a1 delay1_5">这是哪????我怎么会在这里？</p></div>
        <div class="p2_bg2 ani bounceInRight a1 delay2"></div>
        <div class="p2_bg3 ani bounceInLeft a1 delay3_5"><p class="p2_txt3 fHide ani bounceIn a1 delay4_5">喂~你们!!!快醒醒...在这样下去.......</p></div>
        <div class="p2_bg4 ani bounceInUp a1 delay5"></div>
        <p class="p2_txt4 fHide ani ymd a1 delay6">雅蠛蝶！！</p>
	</section>

	<section class="page page3" id="page3">
    	<div class="p3_bg1 ani bounceInDown a1 delay03"><p class="p3_txt1 ani bounceIn a1 delay1">被“雅灭蝶”（一种古老的咒语 -_-|||）唤醒后…</p></div>
        <div class="p3_bg2 ani bounceInLeft a1 delay2"><p class="p3_txt2 fHide ani bounceIn a1 delay3">嘿呦！来了好多人呢！</p><p class="p3_txt3 fHide ani bounceIn a1 delay3_5">斯~真是困难重重啊！</p><p class="p3_txt4 ani bounceIn a1 delay4">一大波姜饼人集合了起来，商讨逃亡路线。</p></div>
        <div class="p3_bg3 ani bounceInRight a1 delay4_5"><p class="p3_txt5 fHide ani bounceIn a1 delay5_5">突破口在这里</p></div>
	</section>
    
	<section class="page page4" id="page4">
		<div class="p4_bg1 ani bounceInRight a1 delay03"><p class="p4_txt1 fHide ani bounceIn a1 delay1">那么，我们就出发吧!!!!</p></div>
        <div class="p4_bg2 ani bounceInLeft a1 delay1_5"><p class="p4_txt2 ani bounceIn a1 delay2_5">没有人知道，他们以后的结局会是什么。</p></div>
        <div class="p4_bg3 ani bounceInRight a1 delay3"><p class="p4_txt3 ani bounceIn a1 delay4">但是……</p><p class="p4_txt4 fHide ani bounceIn a1 delay4_5">呵呵！</p></div>
	</section>
    
	<section class="page page5" id="page5">
    	<div class="p5_hole ani delay0 a3"></div>
        <div class="p5_role ani delay0 a3"></div>
        <div class="p5_tit ani delay06 a5"></div>
        <div class="p5_logo ani bounceInLeft delay09 a3"></div>
    	<div class="light"></div>
        <div class="p5_btn ani bounceInUp delay09 a3"></div>
	</section>
    
    <section class="page page6" id="page6">
        <div class="p6_cho ani bounceInDown delay03 a1"></div>
        <div class="p6_role1 ani bounceInDownFade delay03 a7"></div>
        <div class="p6_role2 ani showTofade delay2 a6"></div>
        <div class="p6_role3 ani showTofade delay3 a6"></div>
        <div class="p6_chain1 ani bounceInDown delay03 a1"></div>
        <div class="p6_txt ani bounceInRight delay03 a3"></div>
        <div class="light"></div>
        <div class="p6_mthd ani showToshow delay4 a6"></div>
        <div class="p6_btn ani bounceInUp delay4 a3"></div>
	</section>
    <section class="page page7" id="page7">
    	<div class="p6_cho"></div>
        <div id="role_rand" class="p6_role2"></div>
        <div class="p6_chain1" id="chain"></div>
        <div class="progress_bar"><div class="bar"></div><div class="time"><span id="sec">10.00</span>秒</div></div>
        <!--<div class="light"></div>-->
    </section>
    <div id="success" class="p7_p6_role2">
    	<a class="fHide again" href="javascript:;">再玩一次</a>
        <a class="pa fHide down_link" href="#">下载游戏</a>
    </div>
    <div id="fail">
    	<a class="fHide again" href="javascript:;">再次逃亡</a><a class="fHide fenx_btn" href="javascript:;">邀请好友来帮助逃亡</a>
    </div>
</div>
<i class="pbtn pbtn_t" id="pbtnT"><img src="<?php echo $full_base_url ?>/wap/images/arrt.png" alt=""></i>
<i class="pbtn pbtn_b" id="pbtnB"><img src="<?php echo $full_base_url ?>/wap/images/arrb.png" alt=""></i>
<div class="mask center" style="display:none;">为了更好的体验，请将手机/平板竖过来</div>
<div class="wx_tip" style="display:none" ontouchstart="document.querySelector('.wx_tip').style.display='none';"><p></p></div>
<script type="text/javascript" src="<?php echo $full_base_url ?>/wap/js/zepto-1.1.3.min.js"></script> 
<script type="text/javascript" src="<?php echo $full_base_url ?>/wap/js/pic.js"></script> 

<script>
var autoScale = function() {
	setTimeout(function() {
		var winW = document.documentElement.clientWidth,
			wrapper = document.querySelector('.wrapper'),
			scale = (winW / 320).toString().substring(0, 6),
			cssText = '-webkit-transform: scale(' + scale + ');-webkit-transform-origin: 0 0;';
		wrapper.style.cssText = cssText;
	}, 300);
};
if (document.documentElement.clientWidth > 320) {
	autoScale();
}
window.addEventListener("onorientationchange" in window ? "orientationchange" : "resize", autoScale, false);

//横竖屏判断
window.addEventListener('load', function() {
	checkDirect();
});
var checkDirect = function() {
    if (document.body.clientWidth > document.body.clientHeight) {
        document.querySelector('.mask').style.display = 'block';
    } else {
       document.querySelector('.mask').style.display = 'none';
    }
}
var evt = "onorientationchanged" in window ? "orientationchanged" : "resize";
window.addEventListener(evt, checkDirect, false);

//图片预加载
var rateNum = document.querySelector('.loading-num'),
	imgPath = "<?php echo $full_base_url ?>/wap/images/";
for (var i = 0; i < sourceArr.length; i++) {
	sourceArr[i] = imgPath + sourceArr[i] ;
};
var loadImage = function(path, callback) {
	var img = new Image();
	img.onload = function() {
		img.onload = null;
		callback(path);
	}
	img.src = path;
}
var imgLoader = function(imgs, callback) {
	var len = imgs.length,
		i = 0;
	while (imgs.length) {
		loadImage(imgs.shift(), function(path) {
			callback(path, ++i, len);
		});
	}
}
imgLoader(sourceArr, function(path, curNum, total) {
	var percent = curNum / total
	rateNum.innerHTML = Math.floor(percent * 100);
	if (percent == 1) {
		setTimeout(showPage, 500);
	}
});

var SHAKE_THRESHOLD = 600;
var last_update = 0;
var x, y, z, last_x, last_y, last_z;
var ds = document.querySelector('#page7');
var sec = document.querySelector('#sec');
var bar = document.querySelector('.bar');
var chain = document.querySelector('#chain');
var again = document.querySelector('.again');
var score = 0;
var begin = false;
var time = 1000;
var end = false;

var showPage = function() {
	document.querySelector(".loading").parentNode.removeChild(document.querySelector(".loading"));
	document.addEventListener('DOMContentLoaded', function(){
    	document.documentElement.style.height = window.innerHeight + 'px';
	});
	
	$("#wp").attr("class","stage"+0);
	var yStart, yEnd, isAnimate = false, isModal = false, index = 0;
	
	document.body.addEventListener('touchstart', function (e){
		var touch = e.changedTouches[0];
		yStart = touch.pageY;
	});
	
	document.body.addEventListener('touchmove', function (e){
		event.preventDefault();	
		var touch = e.changedTouches[0];
		yEnd = touch.pageY;
		xEnd = touch.pageX;
		if(isAnimate || isModal) return false;
		if (yEnd - 100> yStart & yEnd > yStart){ //down
			if(index == 0 || index >= 4) return false;
			setPage(1,--index)
		} else if (yEnd + 100 < yStart & yEnd < yStart){ //up
			if(index >= 4) return false;
			setPage(0,++index);
		}
	});
	
	function setPage(dir,page){
		$("#wp").attr("class","stage"+page);
		isAnimate = true;
		if(dir == 1){
			$("#page"+(page+1)).removeClass("pagev");
			$("#page"+(page+1)).addClass("ploaded");
			$("#page"+(page+2)).removeClass("ploaded");
		}else{
			$("#page"+page).addClass("pagev");
			$("#page"+page).removeClass("ploaded");
			$("#page"+(page+1)).addClass("ploaded");
		}
		setTimeout(function(){
			if(isAnimate) isAnimate = false;
		},750);
	}
	
	$("#pbtnB").bind("click", function(){ setPage(0,++index) } );
	$("#pbtnT").bind("click", function(){ setPage(1,--index) } );
	
	$('.p5_btn').click(function(){
		setPage(0,++index);
	})
	
	$('.p6_btn').click(function(){
		setPage(0,++index);
		var rand = Math.random();
		var randNum = 1 + Math.round(rand * 2);
		$("#role_rand").attr('class',"p6_role"+randNum);
		bar.style.width = "100%";
		score = 0;
		begin = false;
		end = false;
		time = 1000;
		run();
	})
	
	$('.again').click(function()  //再玩一次
	{
		$(this).parent().hide()
	  	setPage(1,--index);
		bar.style.width = "100%";
		score = 0;
		begin = false;
		end = false;
		time = 1000;
	});
}


if (window.DeviceMotionEvent) // 移动浏览器支持运动传感事件
{
  window.addEventListener('devicemotion', deviceMotionHandler, false);
}

function run()
{
  if (begin || end) return;
  begin = true;
  var tid = setInterval(function()  //倒计时开始
  {
	time--;
	if (time < 0)
	{
	  clearInterval(tid);
	  begin = false;
	  end = true;
	  if (score < 10){
		  	 $("#fail").show();
		  }
	  return;
	}
	sec.textContent = (time / 100).toPrecision(time.toString().length);
	bar.style.width = parseInt(time / 10).toPrecision(time.toString().length) + "%";
  }, 10);
}

function deviceMotionHandler(eventData){     //摇手机 方法
  if (!begin)
  {
	ds.style.webkitTransform = 'translate3d(0px,0px,0px)';  //初始化 晃动
	return;
  }
  var acceleration = eventData.accelerationIncludingGravity;
  var curTime = new Date().getTime();
  var diffTime = curTime - last_update;
  var roleNum = $('#role_rand').attr('class');

  if (diffTime > 100 && begin == true)
  {

	last_update = curTime;

	x = acceleration.x;
	y = acceleration.y;
	z = acceleration.z;

	var xdiff = (x - last_x);
	var ydiff = (y - last_y);
	var zdiff = (z - last_z);

	ds.style.webkitTransform = 'translate3d(' + xdiff + 'px,' + ydiff +
	  'px,' + zdiff + 'px)';

	var value = x + y + z;
	var lastvalue = last_x + last_y + last_z;
	var speed = Math.abs(value - lastvalue) /
	  diffTime * 10000;

	if (speed > SHAKE_THRESHOLD)
	{
	     score++;  //摇动手机次数
		 if(score > 20){
				 $("#success").attr("class","p7_" + roleNum);
				 $("#success").show();
				 begin = false;
				 return;
			 }
	}
	last_x = x;
	last_y = y;
	last_z = z;
  }
}
$('.fenx_btn').click(function(){
	$(".wx_tip p").text("点击分享到朋友圈");
  	document.querySelector('.wx_tip').style.display='block';
})

</script>
</body></html>